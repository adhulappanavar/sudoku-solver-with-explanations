<!DOCTYPE html>
<html>
<head>
    <title>Debug Saved Puzzle</title>
</head>
<body>
    <h1>Debug Saved Puzzle</h1>
    <button onclick="debugSavedPuzzle()">Debug Saved Puzzle</button>
    <div id="output"></div>

    <script>
        function debugSavedPuzzle() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            
            try {
                const savedPuzzles = JSON.parse(localStorage.getItem('savedSudokuPuzzles') || '[]');
                output.innerHTML += `<h3>Found ${savedPuzzles.length} saved puzzles:</h3>`;
                
                savedPuzzles.forEach((puzzle, index) => {
                    output.innerHTML += `<h4>Puzzle ${index}: ${puzzle.name}</h4>`;
                    output.innerHTML += `<p>Board size: ${puzzle.board.length}x${puzzle.board[0].length}</p>`;
                    output.innerHTML += `<p>Original board size: ${puzzle.originalBoard.length}x${puzzle.originalBoard[0].length}</p>`;
                    
                    // Show the puzzle
                    output.innerHTML += '<h5>Puzzle:</h5>';
                    output.innerHTML += '<pre>' + puzzle.board.map(row => row.join('')).join('\n') + '</pre>';
                    
                    // Show original puzzle
                    output.innerHTML += '<h5>Original Puzzle:</h5>';
                    output.innerHTML += '<pre>' + puzzle.originalBoard.map(row => row.join('')).join('\n') + '</pre>';
                });
                
                // Test the specific puzzle mentioned by user
                const targetPuzzle = savedPuzzles.find(p => p.name === 'soduko-1_2025-08-10T08-02-15');
                if (targetPuzzle) {
                    output.innerHTML += '<h3>Target Puzzle Found!</h3>';
                    output.innerHTML += '<p>Name: ' + targetPuzzle.name + '</p>';
                    output.innerHTML += '<p>Board: ' + JSON.stringify(targetPuzzle.board) + '</p>';
                    
                    // Test solving this puzzle
                    testSolvePuzzle(targetPuzzle.board);
                } else {
                    output.innerHTML += '<h3>Target Puzzle NOT Found!</h3>';
                    output.innerHTML += '<p>Available names:</p>';
                    savedPuzzles.forEach(p => {
                        output.innerHTML += '<p>- ' + p.name + '</p>';
                    });
                }
                
            } catch (error) {
                output.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }
        
        async function testSolvePuzzle(board) {
            const output = document.getElementById('output');
            
            try {
                output.innerHTML += '<h3>Testing API call...</h3>';
                
                const response = await fetch('https://sudoku-solver-with-explanations.vercel.app/solve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ board: board })
                });
                
                output.innerHTML += `<p>Response status: ${response.status}</p>`;
                
                if (response.ok) {
                    const data = await response.json();
                    output.innerHTML += `<p>✅ API working!</p>`;
                    output.innerHTML += `<p>Steps received: ${data.steps ? data.steps.length : 'undefined'}</p>`;
                    output.innerHTML += `<p>Solved: ${data.is_solved}</p>`;
                    output.innerHTML += `<p>Final board: ${JSON.stringify(data.final_board)}</p>`;
                    
                    if (data.steps) {
                        output.innerHTML += '<h4>First 10 steps:</h4>';
                        data.steps.slice(0, 10).forEach((step, i) => {
                            output.innerHTML += `<p>Step ${i+1}: ${step.technique} - ${step.description}</p>`;
                        });
                        
                        if (data.steps.length > 10) {
                            output.innerHTML += `<p>... and ${data.steps.length - 10} more steps</p>`;
                        }
                    }
                } else {
                    output.innerHTML += `<p style="color: red;">❌ API error: ${response.status}</p>`;
                    const errorText = await response.text();
                    output.innerHTML += `<p>Error response: ${errorText}</p>`;
                }
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">❌ Request failed: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
